# Руководство по эксплуатации

Этот документ — быстрый справочник для повседневной работы с сервером Forge 1.20.1.

## Чеклист запуска
1. Убедись, что `.env` актуален (особенно `LEVEL`, `MODE`, `WHITELIST`).
2. Выполни `make configure` после любых изменений в структуре `data/`.
3. Обнови образ (при необходимости): `make build` или `make pull`.
4. Старт сервера: `make up`.
5. Просматривай логи: `make logs` или `tail -f data/logs/latest.log`.
6. Проверь, что `docker compose ps` показывает состояние `healthy`.

## Типовые команды
| Цель | Команда |
|------|---------|
| Получить сводку по контейнеру | `make status`
| Отправить консольную команду | `scripts/mc-console.sh "say Сервер запущен"`
| Посмотреть последние 200 строк лога | `docker compose logs --tail=200 mc`
| Снять снимок мира | `tar czf backup-$(date +%F).tgz data/my_world`
| Перезапустить сервер без удаления данных | `make restart`

## Добавление или обновление модов
1. Скачай `.jar` и положи его в `data/mods/`.
2. Если мод требует свою конфигурацию, добавь файл в `data/config/`.
3. Останови сервер (`make down`), затем подними заново (`make up`).
4. Следи за логами: большинство конфликтов видно в `latest.log`.

## Работа с миром
- Импорт существующего мира: скопируй содержимое папки мира в `data/my_world` и укажи его имя в `LEVEL`.
- Смена типа мира (`LEVEL_TYPE`, `SEED`) применится только при создании нового мира.
- Перед экспериментами дублируй каталог: `cp -r data/my_world data/my_world_$(date +%H%M)`.

## Диагностика и восстановление
1. `docker compose ps` — видим, в каком состоянии контейнер.
2. `docker compose logs mc` — ищем ошибки Forge/Java.
3. Проверяем место на диске: `df -h /` (если <2 ГБ свободно, сервер будет падать).
4. Проверяем память: `free -h` и `docker stats mc`.
5. При зависании JVM можно отправить `scripts/mc-console.sh "stop"`, затем `make up`.

## Обслуживание
- Раз в неделю очищай старые логи (`find data/logs -type f -mtime +7 -delete`).
- После обновлений модов держи список версий в отдельном файле (например, `mods/VERSIONS.txt`).
- Убедись, что система регулярно ставит security-обновления (`sudo unattended-upgrade`).

Больше советов по настройке геймплея см. в `docs/SERVER_SETTINGS.md`, а по администрированию — в `docs/ADMIN.md`.
